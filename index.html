<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>hello phaser!</title>
    <script src="//cdn.jsdelivr.net/phaser/2.2.2/phaser.min.js"></script>
  </head>
  <body>

  <script type="text/javascript">

  window.onload = function() {

    var game = new Phaser.Game(800, 600, Phaser.AUTO, '', { preload: preload, create: create, update: update }),
      score = 0,
      scoreText,
      ballTrackCooldown = 0,
      ballTrackCooldownText,
      couchBot,
      couchTop,
      chairBottom,
      chairTop,
      couchScratch,
      couchScratchCooldown = 0,
      couchScratchCooldownText,
      coffeeTable,
      ballTrack,
      interact,
      isRickPlaying,
      catTree1,
      catTree2,
      catTree3,
      lampTopCooldown = 0,
      lampTopCooldownText,
      lampTop,
      lampBottom,
      catDancer,
      catDancerCooldown = 0,
      catDancerCooldownText,
      camSpeed = 2,
      cabinetLeft,
      cabinetRight,
      cabinetTop,
      fridge,
      ledge;

    function preload() {
      game.load.image('platform', 'assets/livingroom/hardwood.png');
      game.load.image('ground', 'assets/livingroom/hardwood.png');
      game.load.image('wallArt', 'assets/livingroom/wall-art.png');
      game.load.spritesheet('rick', 'assets/rick-spritee.png', 76, 44, 6);
      game.load.image('couchBottom', 'assets/livingroom/couch-bottom.png');
      game.load.spritesheet('couchScratch', 'assets/livingroom/couch-scratch.png', 28, 42, 2);
      game.load.image('couchTop', 'assets/livingroom/couch-top.png');
      game.load.image('gudetama', 'assets/livingroom/gudetama.png');
      game.load.image('coffeeTable', 'assets/livingroom/coffee-table.png');
      game.load.image('map', 'assets/livingroom/map.png');
      game.load.spritesheet('ballTrack', 'assets/livingroom/ball-track.png', 56, 24, 11);
      game.load.image('catTree', 'assets/livingroom/cat-tree.png');
      game.load.image('catTree1', 'assets/livingroom/platform-1.png');
      game.load.image('catTree2', 'assets/livingroom/platform-2.png');
      game.load.image('catTree3', 'assets/livingroom/platform-1.png');
      game.load.spritesheet('lampTop', 'assets/livingroom/lamp-top.png', 42, 118, 3);
      game.load.image('lampBottom', 'assets/livingroom/lamp-bottom.png');
      game.load.image('chairTop', 'assets/livingroom/chair-top.png');
      game.load.image('chairBottom', 'assets/livingroom/chair-bottom.png');
      game.load.image('tv', 'assets/livingroom/tv.png');
      game.load.spritesheet('catDancer', 'assets/livingroom/cat-dancer.png', 42, 40, 3);
      game.load.image('recordCabinet', 'assets/livingroom/record-cabinet.png');
      game.load.image('cabinetLeft', 'assets/livingroom/cabinet-l.png');
      game.load.image('cabinetRight', 'assets/livingroom/cabinet-r.png');
      game.load.image('cabinetTop', 'assets/livingroom/cabinet-top.png');
      game.load.image('fridge', 'assets/livingroom/fridge.png');
      game.load.image('window', 'assets/livingroom/window.png');
      game.load.image('ledge', 'assets/livingroom/ledge.png');
    }

    function create() {

      //  We're going to be using physics, so enable the Arcade Physics system
      game.physics.startSystem(Phaser.Physics.ARCADE);

      game.world.setBounds(0,0, 4000, 600);

      isRickPlaying = false;

      interact = game.input.keyboard.addKey(Phaser.Keyboard.E);

      game.stage.backgroundColor = '#f8f8f8';

      //  The platforms group contains the ground and the 2 ledges we can jump on
      platforms = game.add.group();

      //  We will enable physics for any object that is created in this group
      platforms.enableBody = true;

      // Here we create the ground.
      var ground = platforms.create(0, game.world.height - 64, 'ground');

      //  Scale it to fit the width of the game (the original sprite is 400x32 in size)
      ground.scale.setTo(1, 1);

      //  This stops it from falling away when you jump on it
      ground.body.immovable = true;

      game.add.sprite(312, 200, 'wallArt');

      // Add couch bottom
      couchBot = game.add.sprite(600, 490, 'couchBottom');
      couchBot.name = 'couchBottom';
      game.physics.enable(couchBot, Phaser.Physics.ARCADE);
      couchBot.body.collideWorldBounds = true;
      couchBot.body.checkCollision.up = true;
      couchBot.body.checkCollision.left = false;
      couchBot.body.checkCollision.right = false;
      couchBot.body.checkCollision.down = false;
      couchBot.body.immovable = true;

      // Add couch top
      couchTop = game.add.sprite(600, 428, 'couchTop');
      couchTop.name = 'couchTop';
      game.physics.enable(couchTop, Phaser.Physics.ARCADE);
      couchTop.body.collideWorldBounds = true;
      couchTop.body.checkCollision.up = true;
      couchTop.body.checkCollision.left = false;
      couchTop.body.checkCollision.right = false;
      couchTop.body.checkCollision.down = false;
      couchTop.body.immovable = true;

      // Add. 
      couchScratch = game.add.sprite(600, 494, 'couchScratch', 0);
      game.physics.enable(couchScratch, Phaser.Physics.ARCADE);
      couchScratch.animations.add('loop');

      // Add chair bottom
      chairBottom = game.add.sprite(980, 490, 'chairBottom');
      chairBottom.name = 'chairBottom';
      game.physics.enable(chairBottom, Phaser.Physics.ARCADE);
      chairBottom.body.collideWorldBounds = true;
      chairBottom.body.checkCollision.up = true;
      chairBottom.body.checkCollision.left = false;
      chairBottom.body.checkCollision.right = false;
      chairBottom.body.checkCollision.down = false;
      chairBottom.body.immovable = true;

      // Add chair top
      chairTop = game.add.sprite(1048, 436, 'chairTop');
      chairTop.name = 'couchTop';
      game.physics.enable(chairTop, Phaser.Physics.ARCADE);
      chairTop.body.collideWorldBounds = true;
      chairTop.body.checkCollision.up = true;
      chairTop.body.checkCollision.left = true;
      chairTop.body.checkCollision.right = true;
      chairTop.body.checkCollision.down = false;
      chairTop.body.immovable = true;

      // kitchen stuff
      cabinetLeft = game.add.sprite(50, 436, 'cabinetLeft');
      cabinetLeft.name = 'cabinetLeft';
      game.physics.enable(cabinetLeft, Phaser.Physics.ARCADE);
      cabinetLeft.body.collideWorldBounds = true;
      cabinetLeft.body.checkCollision.up = true;
      cabinetLeft.body.checkCollision.left = false;
      cabinetLeft.body.checkCollision.right = false;
      cabinetLeft.body.checkCollision.down = false;
      cabinetLeft.body.immovable = true;

      game.add.sprite(0, 218, 'window');

      ledge = game.add.sprite(8, 472, 'ledge');
      ledge.name = 'ledge';
      game.physics.enable(ledge, Phaser.Physics.ARCADE);
      ledge.body.collideWorldBounds = true;
      ledge.body.checkCollision.up = true;
      ledge.body.checkCollision.left = true;
      ledge.body.checkCollision.right = true;
      ledge.body.checkCollision.down = false;
      ledge.body.immovable = true;

      fridge = game.add.sprite(138, 352, 'fridge');
      fridge.name = 'fridge';
      game.physics.enable(fridge, Phaser.Physics.ARCADE);
      fridge.body.collideWorldBounds = true;
      fridge.body.checkCollision.up = true;
      fridge.body.checkCollision.left = false;
      fridge.body.checkCollision.right = false;
      fridge.body.checkCollision.down = false;
      fridge.body.immovable = true;

      // Add lamp
      lampTop = game.add.sprite(920, 370, 'lampTop', 0);
      game.physics.enable(lampTop, Phaser.Physics.ARCADE);
      lampTop.animations.add('loop');

      lampBottom = game.add.sprite(920, 488, 'lampBottom');
      lampBottom.name = 'lampBottom';
      game.physics.enable(lampBottom, Phaser.Physics.ARCADE);
      lampBottom.body.collideWorldBounds = true;
      lampBottom.body.checkCollision.up = true;
      lampBottom.body.checkCollision.left = false;
      lampBottom.body.checkCollision.right = false;
      lampBottom.body.checkCollision.down = false;
      lampBottom.body.immovable = true;

      // Add all cat tree platforms
      catTree1 = game.add.sprite(509, 466, 'catTree1');
      catTree1.name = 'catTree1';
      game.physics.enable(catTree1, Phaser.Physics.ARCADE);
      catTree1.body.collideWorldBounds = true;
      catTree1.body.checkCollision.up = true;
      catTree1.body.checkCollision.left = false;
      catTree1.body.checkCollision.right = false;
      catTree1.body.checkCollision.down = false;
      catTree1.body.immovable = true;

      catTree2 = game.add.sprite(495, 436, 'catTree2');
      catTree2.name = 'catTree2';
      game.physics.enable(catTree2, Phaser.Physics.ARCADE);
      catTree2.body.collideWorldBounds = true;
      catTree2.body.checkCollision.up = true;
      catTree2.body.checkCollision.left = false;
      catTree2.body.checkCollision.right = false;
      catTree2.body.checkCollision.down = false;
      catTree2.body.immovable = true;

      catTree3 = game.add.sprite(509, 404, 'catTree3');
      catTree3.name = 'catTree3';
      game.physics.enable(catTree3, Phaser.Physics.ARCADE);
      catTree3.body.collideWorldBounds = true;
      catTree3.body.checkCollision.up = true;
      catTree3.body.checkCollision.left = false;
      catTree3.body.checkCollision.right = false;
      catTree3.body.checkCollision.down = false;
      catTree3.body.immovable = true;

      // Add couch bottom
      recordCabinet = game.add.sprite(1170, 476, 'recordCabinet');
      recordCabinet.name = 'recordCabinet';
      game.physics.enable(recordCabinet, Phaser.Physics.ARCADE);
      recordCabinet.body.collideWorldBounds = true;
      recordCabinet.body.checkCollision.up = true;
      recordCabinet.body.checkCollision.left = false;
      recordCabinet.body.checkCollision.right = false;
      recordCabinet.body.checkCollision.down = false;
      recordCabinet.body.immovable = true;

      // non-collision decorative sprites
      game.add.sprite(850, 400, 'gudetama');
      game.add.sprite(625, 230, 'map');
      game.add.sprite(495, 342, 'catTree');

      // The player and its settings
      player = game.add.sprite(52, game.world.height - 150, 'rick');

      // Add sprites that rick goes behind here. 
      ballTrack = game.add.sprite(450, 520, 'ballTrack', 1);
      game.physics.enable(ballTrack, Phaser.Physics.ARCADE);
      ballTrack.animations.add('loop');

      catDancer = game.add.sprite(1120, 500, 'catDancer', 0);
      game.physics.enable(catDancer, Phaser.Physics.ARCADE);
      catDancer.animations.add('loop');

      game.add.sprite(1174, 396, 'tv');

      // Add coffee table
      coffeeTable = game.add.sprite(640, 510, 'coffeeTable');
      coffeeTable.name = 'coffeeTable';
      game.physics.enable(coffeeTable, Phaser.Physics.ARCADE);
      coffeeTable.body.collideWorldBounds = true;
      coffeeTable.body.checkCollision.up = true;
      coffeeTable.body.checkCollision.left = false;
      coffeeTable.body.checkCollision.right = false;
      coffeeTable.body.checkCollision.down = false;
      coffeeTable.body.immovable = true;

      //  We need to enable physics on the player
      game.physics.arcade.enable(player);

      //  Player physics properties. Give the little guy a slight bounce.
      player.body.bounce.y = 0.1;
      player.body.gravity.y = 800;
      player.body.collideWorldBounds = true;

      //  Our two animations, walking left and right.
      player.animations.add('left', [0, 1], 8, true);
      player.animations.add('right', [4, 5], 8, true);

      cursors = game.input.keyboard.createCursorKeys();

      scoreText = game.add.text(16, 16, 'score: 0', { font: 'bold 30px BubbleButts', fill: '#000', });
      scoreText.fixedToCamera = true;
      
      ballTrackCooldownText = game.add.text(440, 480, '', { font: 'Normal 12px Magic Forest', fill: '#000', });
      lampTopCooldownText = game.add.text(910, 400, '', { font: 'Normal 12px Magic Forest', fill: '#000', });
      couchScratchCooldownText = game.add.text(540, 475, '', { font: 'Normal 12px Magic Forest', fill: '#000', });
      catDancerCooldownText = game.add.text(1120, 475, '', { font: 'Normal 12px Magic Forest', fill: '#000', });
    }

    function update() {

      //  Collide Rick with sprites
      game.physics.arcade.collide(player, platforms);
      game.physics.arcade.collide(player, couchBot);
      game.physics.arcade.collide(player, couchTop);
      game.physics.arcade.collide(player, catTree1);
      game.physics.arcade.collide(player, catTree2);
      game.physics.arcade.collide(player, catTree3);
      game.physics.arcade.collide(player, lampBottom);
      game.physics.arcade.collide(player, chairTop);
      game.physics.arcade.collide(player, chairBottom);
      game.physics.arcade.collide(player, recordCabinet);
      game.physics.arcade.collide(player, cabinetLeft);
      game.physics.arcade.collide(player, ledge);
      game.physics.arcade.collide(player, fridge);

      //  Reset the players velocity (movement)
      player.body.velocity.x = 0;

      // Handle cooldowns.
      if (ballTrackCooldown > 0) {
        ballTrackCooldown -= 1;
        ballTrackCooldownText.text = 'cooldown: ' + Math.round(ballTrackCooldown / 60);
      }
      else if (ballTrackCooldown == 0) {
        ballTrackCooldownText.text = '';
      }

      if (lampTopCooldown > 0) {
        lampTopCooldown -= 1;
        lampTopCooldownText.text = 'cooldown: ' + Math.round(lampTopCooldown / 60);
      }
      else if (lampTopCooldown == 0) {
        lampTopCooldownText.text = '';
      }

      if (couchScratchCooldown > 0) {
        couchScratchCooldown -= 1;
        couchScratchCooldownText.text = 'cooldown: ' + Math.round(couchScratchCooldown / 60);
      }
      else if (couchScratchCooldown == 0) {
        couchScratchCooldownText.text = '';
      }

      if (catDancerCooldown > 0) {
        catDancerCooldown -= 1;
        catDancerCooldownText.text = 'cooldown: ' + Math.round(catDancerCooldown / 60);
      }
      else if (catDancerCooldown == 0) {
        catDancerCooldownText.text = '';
      }

      if (isRickPlaying == false) {
        if (cursors.left.isDown)
        {
          game.camera.x -= camSpeed;
          //  Move to the left
          player.body.velocity.x = -150;

          player.animations.play('left');
        }
        else if (cursors.right.isDown)
        {
          game.camera.x += camSpeed;
          //  Move to the right
          player.body.velocity.x = 150;

          player.animations.play('right');
        }
        else
        {
          //  Stand still
          player.animations.stop();

          player.frame = 4;
        }

        if (ballTrackCooldown == 0) {
          // Check for Rick to overlap with sprite and make something happen
          game.physics.arcade.overlap(player, ballTrack, trackPlay, null, this);
        }

        if (lampTopCooldown == 0) {
          // Check for Rick to overlap with sprite and make something happen
          game.physics.arcade.overlap(player, lampTop, lampPlay, null, this);
        }

        if (couchScratchCooldown == 0) {
          // Check for Rick to overlap with sprite and make something happen
          game.physics.arcade.overlap(player, couchScratch, couchScratchPlay, null, this);
        }

        if (catDancerCooldown == 0) {
          // Check for Rick to overlap with sprite and make something happen
          game.physics.arcade.overlap(player, catDancer, catDancerPlay, null, this);
        }

        //  Allow the player to jump if they are touching the ground.
        if (cursors.up.isDown && player.body.touching.down)
        {
          player.body.velocity.y = -350;
        }

      }

      function trackPlay(player, ballTrack) {
        if (interact.isDown && interact.repeats == 1)
        {
          ballTrack.animations.play('loop', 11, true);
          ballTrackCooldown = 30 * 60; // 60fps, 30 seconds
          score += 50;
          scoreText.text = 'Score: ' + score;
          ballTrackCooldownText.text = 'cooldown: ' + (ballTrackCooldown / 60);
          isRickPlaying = true;
          player.animations.play('left');
          setTimeout(function() {
            player.animations.stop();
            ballTrack.animations.stop();
            isRickPlaying = false;
          }, 3000);
        }
      }

      function lampPlay(player, lampTop) {
        if (interact.isDown && interact.repeats == 1)
        {
          lampTop.animations.play('loop', 3, true);
          lampTopCooldown = 30 * 60; // 60fps, 30 seconds
          score += 50;
          scoreText.text = 'Score: ' + score;
          lampTopCooldownText.text = 'cooldown: ' + (lampTopCooldown / 60);
          isRickPlaying = true;
          player.animations.play('left');
          setTimeout(function() {
            player.animations.stop();
            lampTop.animations.stop();
            isRickPlaying = false;
          }, 3000);
        }
      }

      function couchScratchPlay(player, couchScratch) {
        if (interact.isDown && interact.repeats == 1)
        {
          couchScratch.animations.play('loop', 2, true);
          couchScratchCooldown = 30 * 60; // 60fps, 30 seconds
          score += 50;
          scoreText.text = 'Score: ' + score;
          couchScratchCooldownText.text = 'cooldown: ' + (couchScratchCooldown / 60);
          isRickPlaying = true;
          player.animations.play('left');
          setTimeout(function() {
            player.animations.stop();
            couchScratch.animations.stop();
            isRickPlaying = false;
          }, 3000);
        }
      }

      function catDancerPlay(player, catDancer) {
        if (interact.isDown && interact.repeats == 1)
        {
          catDancer.animations.play('loop', 2, true);
          catDancerCooldown = 30 * 60; // 60fps, 30 seconds
          score += 50;
          scoreText.text = 'Score: ' + score;
          catDancerCooldownText.text = 'cooldown: ' + (catDancerCooldown / 60);
          isRickPlaying = true;
          player.animations.play('left');
          setTimeout(function() {
            player.animations.stop();
            catDancer.animations.stop();
            isRickPlaying = false;
          }, 3000);
        }
      }

    }

  };

  </script>

  </body>
</html>
