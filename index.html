<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>hello phaser!</title>
    <script src="//cdn.jsdelivr.net/phaser/2.2.2/phaser.min.js"></script>
  </head>
  <body>

  <script type="text/javascript">

  window.onload = function() {

    var game = new Phaser.Game(800, 600, Phaser.AUTO, '', { preload: preload, create: create, update: update }),
      score = 0,
      scoreText,
      couchBot,
      couchTop,
      coffeeTable,
      catTree,
      ballTrack,
      interact,
      rickPlaying,
      camSpeed = 1;

    function preload() {
      game.load.image('platform', 'assets/livingroom/hardwood.png');
      game.load.image('ground', 'assets/livingroom/hardwood.png');
      game.load.spritesheet('rick', 'assets/rick-spritee.png', 76, 44, 6);
      game.load.image('couchBottom', 'assets/livingroom/couch-bottom.png');
      game.load.image('couchTop', 'assets/livingroom/couch-top.png');
      game.load.image('gudetama', 'assets/livingroom/gudetama.png');
      game.load.image('coffeeTable', 'assets/livingroom/coffee-table.png');
      game.load.image('map', 'assets/livingroom/map.png');
      game.load.image('catTree', 'assets/livingroom/cat-tree.png');
      game.load.spritesheet('ballTrack', 'assets/livingroom/ball-track.png', 56, 24, 11);
    }

    function create() {

      //  We're going to be using physics, so enable the Arcade Physics system
      game.physics.startSystem(Phaser.Physics.ARCADE);

      //  The platforms group contains the ground and the 2 ledges we can jump on
      platforms = game.add.group();

      //  We will enable physics for any object that is created in this group
      platforms.enableBody = true;

      // Here we create the ground.
      var ground = platforms.create(0, game.world.height - 64, 'ground');

      //  Scale it to fit the width of the game (the original sprite is 400x32 in size)
      ground.scale.setTo(1, 1);

      //  This stops it from falling away when you jump on it
      ground.body.immovable = true;

      game.world.setBounds(0,0, 4000, 600);

      rickPlaying = false;

      interact = game.input.keyboard.addKey(Phaser.Keyboard.E);

      game.stage.backgroundColor = '#f8f8f8';

      ballTrack = game.add.sprite(150, 520, 'ballTrack', 1);
      game.physics.enable(ballTrack, Phaser.Physics.ARCADE);
      ballTrack.animations.add('loop');

      // Add couch bottom
      couchBot = game.add.sprite(300, 490, 'couchBottom');
      couchBot.name = 'couchBottom';
      game.physics.enable(couchBot, Phaser.Physics.ARCADE);
      couchBot.body.collideWorldBounds = true;
      couchBot.body.checkCollision.up = true;
      couchBot.body.checkCollision.left = false;
      couchBot.body.checkCollision.right = false;
      couchBot.body.checkCollision.down = false;
      couchBot.body.immovable = true;

      // Add couch bottom
      coffeeTable = game.add.sprite(340, 510, 'coffeeTable');
      coffeeTable.name = 'coffeeTable';
      game.physics.enable(coffeeTable, Phaser.Physics.ARCADE);
      coffeeTable.body.collideWorldBounds = true;
      coffeeTable.body.checkCollision.up = true;
      coffeeTable.body.checkCollision.left = false;
      coffeeTable.body.checkCollision.right = false;
      coffeeTable.body.checkCollision.down = false;
      coffeeTable.body.immovable = true;

      // Add couch top
      couchTop = game.add.sprite(300, 428, 'couchTop');
      couchTop.name = 'couchTop';
      game.physics.enable(couchTop, Phaser.Physics.ARCADE);
      couchTop.body.collideWorldBounds = true;
      couchTop.body.checkCollision.up = true;
      couchTop.body.checkCollision.left = false;
      couchTop.body.checkCollision.right = false;
      couchTop.body.checkCollision.down = false;
      couchTop.body.immovable = true;

      // non-collision decorative sprites
      game.add.sprite(550, 400, 'gudetama');
      game.add.sprite(325, 230, 'map');
      game.add.sprite(195, 342, 'catTree');

      // The player and its settings
      player = game.add.sprite(52, game.world.height - 150, 'rick');

      //  We need to enable physics on the player
      game.physics.arcade.enable(player);

      //  Player physics properties. Give the little guy a slight bounce.
      player.body.bounce.y = 0.1;
      player.body.gravity.y = 800;
      player.body.collideWorldBounds = true;

      //  Our two animations, walking left and right.
      player.animations.add('left', [0, 1], 8, true);
      player.animations.add('right', [4, 5], 8, true);

      cursors = game.input.keyboard.createCursorKeys();

      scoreText = game.add.text(16, 16, 'score: 0', { font: 'bold 30px BubbleButts', fill: '#000', });


    }

    function update() {

      //  Collide Rick with sprites
      game.physics.arcade.collide(player, platforms);
      game.physics.arcade.collide(player, couchBot);
      game.physics.arcade.collide(player, couchTop);

      //  Reset the players velocity (movement)
      player.body.velocity.x = 0;


      if (rickPlaying == false) {
        if (cursors.left.isDown)
        {

          game.camera.x -= camSpeed;
          //  Move to the left
          player.body.velocity.x = -150;

          player.animations.play('left');
        }
        else if (cursors.right.isDown)
        {

          game.camera.x += camSpeed;

          //  Move to the right
          player.body.velocity.x = 150;

          player.animations.play('right');
        }
        else
        {
          //  Stand still
          player.animations.stop();

          player.frame = 4;
        }
      }

      //  Allow the player to jump if they are touching the ground.
      if (cursors.up.isDown && player.body.touching.down)
      {
        player.body.velocity.y = -350;
      }

      // Check for Rick to overlap with sprite and make something happen

      game.physics.arcade.overlap(player, ballTrack, trackPlay, null, this);

      function trackPlay(player, ballTrack) {
        if (interact.isDown && interact.repeats == 1)
        {
          return rickPlay();
        }
      }

      function rickPlay() {
        ballTrack.animations.play('loop', 11, false);
        score += 50;
        scoreText.text = 'Score: ' + score;
      }

    }

  };

  </script>

  </body>
</html>